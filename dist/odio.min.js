var VIEWAREA={w:768,h:512},SCROLLBUTTONSIZE=32,VIEWPORT={w:VIEWAREA.w+SCROLLBUTTONSIZE,h:VIEWAREA.h+SCROLLBUTTONSIZE},World={width:1280,height:768},CameraControl=function(t){this.camera=t,this.isMoving=!1,this.bounds=new scintilla.BoundingBox(t.bounds);var s={x:0,y:0},e={x:0,y:0},h=0;this.move=function(t,i){this.isMoving=!0,e.x=this.camera.x,e.y=this.camera.y,s.x=e.x+t,s.y=e.y+i,h=0},this.update=function(t){!1!==this.isMoving&&(this.bounds.copy(this.camera.bounds),this.bounds.decrease(64,64),this.bounds.move(64,64),1<=(h+=t/.5)?(this.camera.x=s.x,this.camera.y=s.y,h=0,this.isMoving=!1):(this.camera.x=scintilla.Math.lerp(e.x,s.x,h),this.camera.y=scintilla.Math.lerp(e.y,s.y,h)))}},GameScene=function(){var e,h,t,i,s=VIEWAREA.w/640*.5,o=VIEWAREA.h/384*.501;console.log(s),this.start=function(){e=new CameraControl(this.camera),h=new ScrollsControl(this.game.system.render.canvas),this.bg=this.create.sprite("bg"),t=this.create.rectangle(),(i=t.modules.get("render")).width=64,i.height=64,t.position.set(VIEWAREA.w/2-32,VIEWAREA.h/2-32)},this.update=function(t){if(!1===e.isMoving){var i=this.key.pressed(scintilla.KeyCode.Down)-this.key.pressed(scintilla.KeyCode.Up),s=this.key.pressed(scintilla.KeyCode.Right)-this.key.pressed(scintilla.KeyCode.Left);0!==i?e.move(0,64*i):0!==s&&e.move(64*s,0)}e.update(t),this.bg.x=this.camera.x-this.camera.x/World.width*World.width*.1,h.update(e,this.mouse.position)},this.gui=function(t){t.composite="difference",t.spriteScaled("fog",0,0,s,o),t.spriteScaled("fog",0,0,s,o),t.composite="source-over",h.render(t)}},TitleScene=function(){var i=VIEWAREA.w/2,s=VIEWAREA.h/2-64,e=0,h=0,o=0;this.preload=function(){this.load.setPath("assets/"),this.load.image("bg","background.jpg"),this.load.image("fog","fog.png"),this.load.image("arrow","arrow.png"),this.load.image("arrow_hover","arrow_hover.png"),this.load.image("arrow_pressed","arrow_pressed.png"),this.load.image("scroll_bg","scroll_bg.png"),this.load.image("title_0","title_burn.png"),this.load.image("title_1","title_multiply.png"),this.load.image("title_2","title_overlay.png")},this.postload=function(){this.cache.pattern.create("scroll_bg")},this.update=function(t){.15<(o+=t)&&(e=scintilla.Random.range(-2,2),h=scintilla.Random.range(-2,2),o=0),this.key.pressed(scintilla.KeyCode.Enter)&&this.scene.set("game")},this.gui=function(t){t.sprite("bg",0,0),t.alpha=1,t.composite="color-burn",t.sprite("title_0",i+h,s-31.5+e,.5,.5),t.composite="multiply",t.sprite("title_1",i,s-31.5,.5,.5),t.alpha=.51,t.composite="overlay",t.sprite("title_2",i,s,.5,.5)}},config={width:VIEWPORT.w,height:VIEWPORT.h,parent:"body",debug:!1,pixelated:!1,roundPixels:!1},game=new scintilla.Game(config);console.log(TitleScene),game.scene.add("title",TitleScene),game.scene.add("game",GameScene),game.scene.set("title");var HORIZONTAL=0,VERTICAL=1,MIN=0,MAX=1,ButtonImageScale={x:SCROLLBUTTONSIZE/75,y:SCROLLBUTTONSIZE/77},ButtomHalfImage={x:74*ButtonImageScale.x*.5,y:77*ButtonImageScale.y*.5},Scroll=function(t,o){this.side=t,this.arrowSize=o,this.trackLength=0,this.thumbSpaceLength=0,this.thumb=new Thumb(this,t),this.buttons=[new Button(this,MIN),new Button(this,MAX)],this.x=0,this.y=0,this.thumbTrackMin=0,this.thumbTrackMax=0,this.min=0,this.max=0,this.render=function(t,i){if(i.color="#241F0C",this.side===VERTICAL)i.patternTransformed("scroll_bg",this.x+o,this.y,t.height-o,void 0,ButtonImageScale.x,1,90);else i.patternTransformed("scroll_bg",this.x,this.y,t.width-o,void 0,1,ButtonImageScale.y,0);this.thumb.render(i),this.buttons[0].render(i),this.buttons[1].render(i)},this.update=function(t,i){t.isMoving&&(this.side===VERTICAL?this.thumb.setLocation(t.camera.y/World.height):this.thumb.setLocation(t.camera.x/World.width)),this.buttons[0].update(i),this.buttons[1].update(i)},this.init=function(t,i){var s=50,e=3*o,h=2*o;this.side===VERTICAL?(this.thumbSpaceLength=i.y-e,this.x=t.width-this.arrowSize,this.y=0,s=Math.max(50,this.thumbSpaceLength*(i.y/World.height)),this.max=t.height-h):(this.thumbSpaceLength=i.x-e,this.x=0,this.y=t.height-this.arrowSize,s=Math.max(50,this.thumbSpaceLength*(i.x/World.width)),this.max=t.width-h),this.thumb.size=s,this.thumbTrackMin=this.arrowSize,this.thumbTrackMax=this.max-s,this.trackLength=this.thumbSpaceLength,this.buttons[0].init(),this.buttons[1].init(),this.thumb.setLocation(0)}},Button=function(t,i){this.scroll=t,this.which=i,this.rect=new scintilla.Rect,this.state=0,this.spr="arrow",this.scale={x:ButtonImageScale.x,y:ButtonImageScale.y},this.ang=0,this.init=function(){var t=this.scroll.arrowSize;this.rect.set(this.scroll.x,this.scroll.y,t,t),this.which===MAX?this.scroll.side===VERTICAL?(this.rect.y=this.scroll.y+this.scroll.max,this.ang=90):this.rect.x=this.scroll.x+this.scroll.max:this.scroll.side===HORIZONTAL?this.scale.x*=-1:this.ang=-90},this.update=function(t){this.rect.contains(t.x,t.y)?0===this.state&&(this.state=1,this.spr="arrow_hover"):0!==this.state&&(this.state=0,this.spr="arrow")},this.render=function(t){t.color="green",t.spriteTransformed(this.spr,this.rect.x+ButtomHalfImage.x,this.rect.y+ButtomHalfImage.y,this.scale.x,ButtonImageScale.y,this.ang,.5,.5)}},ScrollsControl=function(i){this.canvas=i,init=function(){var t=SCROLLBUTTONSIZE;this.viewport={x:VIEWPORT.w,y:VIEWPORT.h},this.verticalScroll=new Scroll(VERTICAL,t),this.horizontalScroll=new Scroll(HORIZONTAL,t),this.verticalScroll.init(i,this.viewport),this.horizontalScroll.init(i,this.viewport)}.call(this),this.update=function(t,i){this.verticalScroll.update(t,i),this.horizontalScroll.update(t,i)},this.render=function(t){var i=t.canvas;this.verticalScroll.render(i,t),this.horizontalScroll.render(i,t)}},BORDER_COLOR="#4d4c49",Thumb=function(t){this.scroll=t,this.size=0,this.location=0,this.render=function(t){t.color="#c1b89c",this.scroll.side===VERTICAL?(t.rect(this.scroll.x,this.location,this.scroll.arrowSize-1,this.size),t.outlineRect(this.scroll.x,this.location,this.scroll.arrowSize-1,this.size,2,BORDER_COLOR)):(t.rect(this.location,this.scroll.y,this.size,this.scroll.arrowSize),t.outlineRect(this.location,this.scroll.y,this.size,this.scroll.arrowSize-1,2,BORDER_COLOR))},this.setLocation=function(t){this.location=scintilla.Math.lerp(this.scroll.thumbTrackMin,this.scroll.thumbTrackMax,t)}};